From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: DoctaEnkoda <bierquejason@gmail.com>
Date: Mon, 3 May 2021 01:33:14 +0200
Subject: [PATCH] Allows to display progress messages by player instead to
 everyone on the server.


diff --git a/src/main/java/net/minecraft/server/AdvancementDataPlayer.java b/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
index 59d781b5e61c5d2c004bc92300d8d42e81821308..f37a4a6dccd808e5681cd6e415a0b0e1b6fecb29 100644
--- a/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
+++ b/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
@@ -298,6 +298,7 @@ public class AdvancementDataPlayer {
 
     }
 
+    public ChatMessage getMessagePlayerAdvancement(Advancement advancement) { return new ChatMessage("chat.type.advancement." + advancement.c().e().a(), this.player.getScoreboardDisplayName(), advancement.j()); } // Purpur - OBFHELPER
     public boolean grantCriteria(Advancement advancement, String s) {
         boolean flag = false;
         AdvancementProgress advancementprogress = this.getProgress(advancement);
@@ -317,7 +318,13 @@ public class AdvancementDataPlayer {
                 this.player.world.getServer().getPluginManager().callEvent(new org.bukkit.event.player.PlayerAdvancementDoneEvent(this.player.getBukkitEntity(), advancement.bukkit)); // CraftBukkit
                 advancement.d().a(this.player);
                 if (advancement.c() != null && advancement.c().i() && this.player.world.getGameRules().getBoolean(GameRules.ANNOUNCE_ADVANCEMENTS)) {
-                    this.e.sendMessage(new ChatMessage("chat.type.advancement." + advancement.c().e().a(), new Object[]{this.player.getScoreboardDisplayName(), advancement.j()}), ChatMessageType.SYSTEM, SystemUtils.b);
+                    // Purpur Start - AdvancementMessage By Player
+                    if (net.pl3x.purpur.PurpurConfig.advancementOnlyBroadcastToAffectedPlayer) {
+                        this.player.sendMessage(getMessagePlayerAdvancement(advancement), SystemUtils.b);
+                    } else {
+                        this.e.sendMessage(getMessagePlayerAdvancement(advancement), ChatMessageType.SYSTEM, SystemUtils.b);
+                    }
+                    // Purpur End
                 }
             }
         }
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index 56424e45c04e7165c0671f74cdcd0147d1069af7..b510ec6fc0c915f3018e039cf1ac19bb773eb53a 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -287,4 +287,9 @@ public class PurpurConfig {
     private static void tpsCatchup() {
         tpsCatchup = getBoolean("settings.tps-catchup", tpsCatchup);
     }
+
+    public static boolean advancementOnlyBroadcastToAffectedPlayer  = false;
+    private static void advancementSettings() {
+        advancementOnlyBroadcastToAffectedPlayer  = getBoolean("settings.advancement.only-broadcast-to-affected-player", advancementOnlyBroadcastToAffectedPlayer );
+    }
 }
