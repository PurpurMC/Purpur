From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Encode42 <me@encode42.dev>
Date: Tue, 16 Mar 2021 19:50:58 -0400
Subject: [PATCH] Config to make Creepers explode on death


diff --git a/src/main/java/net/minecraft/server/EntityCreeper.java b/src/main/java/net/minecraft/server/EntityCreeper.java
index 523988bcc0607198dfb73afca5932ed6dd82cca1..7b69eddd21e7effee63cbd4c78976eb87ed5d633 100644
--- a/src/main/java/net/minecraft/server/EntityCreeper.java
+++ b/src/main/java/net/minecraft/server/EntityCreeper.java
@@ -102,6 +102,14 @@ public class EntityCreeper extends EntityMonster {
     public void initAttributes() {
         this.getAttributeInstance(GenericAttributes.MAX_HEALTH).setValue(this.world.purpurConfig.creeperMaxHealth);
     }
+
+    public void die() {
+        super.die();
+
+        if (this.world.purpurConfig.creeperExplodeWhenKilled && this.getKillingEntity() instanceof EntityPlayer) {
+            this.explode();
+        }
+    }
     // Purpur end
 
     @Override
@@ -297,7 +305,7 @@ public class EntityCreeper extends EntityMonster {
             if (!event.isCancelled()) {
                 this.killed = true;
                 this.world.createExplosion(this, this.locX(), this.locY(), this.locZ(), event.getRadius(), event.getFire(), explosion_effect);
-                this.die();
+                if (!this.dead) this.die(); // Purpur
                 this.createEffectCloud();
             } else {
                 fuseTicks = 0;
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index e3dccf08a9b931f83e0c0a218f5db60e643f7674..5ce9e76e4aad9338b950a30cc90d7f2f77eba271 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -699,12 +699,14 @@ public class PurpurWorldConfig {
 
     public boolean creeperRidable = false;
     public boolean creeperRidableInWater = false;
+    public boolean creeperExplodeWhenKilled = false;
     public boolean creeperAllowGriefing = true;
     public double creeperChargedChance = 0.0D;
     public double creeperMaxHealth = 20.0D;
     private void creeperSettings() {
         creeperRidable = getBoolean("mobs.creeper.ridable", creeperRidable);
         creeperRidableInWater = getBoolean("mobs.creeper.ridable-in-water", creeperRidableInWater);
+        creeperExplodeWhenKilled = getBoolean("mobs.creeper.explode-when-killed", creeperExplodeWhenKilled);
         creeperAllowGriefing = getBoolean("mobs.creeper.allow-griefing", creeperAllowGriefing);
         creeperChargedChance = getDouble("mobs.creeper.naturally-charged-chance", creeperChargedChance);
         if (PurpurConfig.version < 10) {
