From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Encode42 <me@encode42.dev>
Date: Fri, 8 Jan 2021 16:07:32 -0500
Subject: [PATCH] Config to allow Note Block sounds when blocked

Allows for Note Blocks to ignore whether or not there's air above them to play.

Normally, the sounds will only play when the block directly above is air.
With this patch enabled, players can place any block above the Note Block and it will still work.

diff --git a/src/main/java/net/minecraft/world/level/block/NoteBlock.java b/src/main/java/net/minecraft/world/level/block/NoteBlock.java
index 9fe1680de418d6ea8d06db9b54f713f661938bee..a2e58f893654692a7e36183922999cb157b1b97c 100644
--- a/src/main/java/net/minecraft/world/level/block/NoteBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/NoteBlock.java
@@ -64,7 +64,7 @@ public class NoteBlock extends Block {
     }
 
     private void playNote(@Nullable Entity entity, Level world, BlockPos blockposition, BlockState data) { // CraftBukkit
-        if (world.getBlockState(blockposition.above()).isAir()) {
+        if (world.purpurConfig().blocks.noteBlock.ignoreBlockAbove || world.getBlockState(blockposition.above()).isAir()) { // Purpur
             // CraftBukkit start
             // org.bukkit.event.block.NotePlayEvent event = org.bukkit.craftbukkit.event.CraftEventFactory.callNotePlayEvent(world, blockposition, data.getValue(NoteBlock.INSTRUMENT), data.getValue(NoteBlock.NOTE)); // Paper - move event into block event handler
             // if (event.isCancelled()) {
diff --git a/src/main/java/org/purpurmc/purpur/configuration/PurpurWorldConfiguration.java b/src/main/java/org/purpurmc/purpur/configuration/PurpurWorldConfiguration.java
index 14ee1e6f889c79890c000eda4e57ff359bd12dda..40e736bf649b12720ebaecc905d6fa2df4609b9a 100644
--- a/src/main/java/org/purpurmc/purpur/configuration/PurpurWorldConfiguration.java
+++ b/src/main/java/org/purpurmc/purpur/configuration/PurpurWorldConfiguration.java
@@ -1682,6 +1682,11 @@ public class PurpurWorldConfiguration extends ConfigurationPart {
         public class PowderSnow extends ConfigurationPart {
             public boolean bypassMobGriefing = false;
         }
+
+        public NoteBlock noteBlock;
+        public class NoteBlock extends ConfigurationPart {
+            public boolean ignoreBlockAbove = false;
+        }
     }
 
     public ArmorStand armorstand;
