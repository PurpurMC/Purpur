From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Encode42 <me@encode42.dev>
Date: Tue, 23 Mar 2021 15:40:45 -0400
Subject: [PATCH] Config to disable hostile mob spawn on ice


diff --git a/src/main/java/net/minecraft/world/entity/monster/EntityMonster.java b/src/main/java/net/minecraft/world/entity/monster/EntityMonster.java
index c484e27650364b6537fe6b2e8e14de98382b86a3..c881c023273edf5bc2ec3ba56566503ed788ae26 100644
--- a/src/main/java/net/minecraft/world/entity/monster/EntityMonster.java
+++ b/src/main/java/net/minecraft/world/entity/monster/EntityMonster.java
@@ -24,6 +24,8 @@ import net.minecraft.world.level.GeneratorAccess;
 import net.minecraft.world.level.IWorldReader;
 import net.minecraft.world.level.World;
 import net.minecraft.world.level.WorldAccess;
+import net.minecraft.world.level.block.Blocks;
+import net.minecraft.world.level.block.state.IBlockData;
 
 public abstract class EntityMonster extends EntityCreature implements IMonster {
 
@@ -95,6 +97,13 @@ public abstract class EntityMonster extends EntityCreature implements IMonster {
     }
 
     public static boolean a(WorldAccess worldaccess, BlockPosition blockposition, Random random) {
+        // Purpur start
+        IBlockData spawnBlock = worldaccess.getType(blockposition.down());
+        World world = worldaccess.getMinecraftWorld();
+        if ((!world.purpurConfig.mobsSpawnOnPackedIce && spawnBlock.equals(Blocks.PACKED_ICE)) || (!world.purpurConfig.mobsSpawnOnBlueIce && spawnBlock.equals(Blocks.BLUE_ICE))) {
+            return false;
+        }
+        // Purpur end
         if (worldaccess.getBrightness(EnumSkyBlock.SKY, blockposition) > random.nextInt(32)) {
             return false;
         } else {
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index adb9166b15654a81b2a852b518beea52a1ee8327..b28bf41a08c2dddc76f2dd056cd9a2882510d06d 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -437,8 +437,12 @@ public class PurpurWorldConfig {
     }
 
     public boolean snowOnBlueIce = true;
+    public boolean mobsSpawnOnPackedIce = true;
+    public boolean mobsSpawnOnBlueIce = true;
     private void iceSettings() {
         snowOnBlueIce = getBoolean("blocks.blue_ice.allow-snow-formation", snowOnBlueIce);
+        mobsSpawnOnPackedIce = getBoolean("blocks.packed_ice.allow-mob-spawns", mobsSpawnOnPackedIce);
+        mobsSpawnOnBlueIce = getBoolean("blocks.blue_ice.allow-mob-spawns", mobsSpawnOnBlueIce);
     }
 
     public boolean chestOpenWithBlockOnTop = false;
