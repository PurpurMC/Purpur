From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ben Kerllenevich <me@notom3ga.me>
Date: Wed, 17 Mar 2021 09:22:34 -0500
Subject: [PATCH] Bookshelf Containers


diff --git a/src/main/java/net/minecraft/server/BlockBookshelf.java b/src/main/java/net/minecraft/server/BlockBookshelf.java
new file mode 100644
index 0000000000000000000000000000000000000000..399b85ad7d8af25b288ac35a7d205e50ab3ff09f
--- /dev/null
+++ b/src/main/java/net/minecraft/server/BlockBookshelf.java
@@ -0,0 +1,47 @@
+package net.minecraft.server;
+
+import org.jetbrains.annotations.Nullable;
+
+public class BlockBookshelf extends BlockTileEntity {
+
+    public BlockBookshelf(BlockBase.Info info) {
+        super(info);
+    }
+
+    @Override
+    public EnumInteractionResult interact(IBlockData data, World world, BlockPosition position, EntityHuman human, EnumHand hand, MovingObjectPositionBlock movingObjectPositionBlock) {
+        TileEntity tileEntity = world.getTileEntity(position);
+
+        if (tileEntity instanceof TileEntityBookshelf) {
+            human.openContainer((TileEntityBookshelf) tileEntity);
+        }
+
+        return EnumInteractionResult.CONSUME;
+    }
+
+    @Override
+    public void remove(IBlockData data, World world, BlockPosition position, IBlockData data1, boolean flag) {
+        if (!data.equals(data1.getBlock())) {
+            TileEntity tileEntity = world.getTileEntity(position);
+
+            if (tileEntity instanceof TileEntityBookshelf) {
+                InventoryUtils.dropInventory(world, position, (TileEntityBookshelf) tileEntity);
+                world.updateAdjacentComparators(position, this);
+            }
+
+            super.remove(data, world, position, data1, flag);
+        }
+    }
+
+    @Nullable
+    @Override
+    public TileEntity createTile(IBlockAccess access) {
+        return new TileEntityBookshelf();
+    }
+
+    @Override
+    public EnumRenderType b(IBlockData iblockdata) {
+        return EnumRenderType.MODEL;
+    }
+
+}
diff --git a/src/main/java/net/minecraft/server/Blocks.java b/src/main/java/net/minecraft/server/Blocks.java
index 4f94dae2955421b09cefa11e61493462f384e650..94ae69035d4dfebba178a1faa66b2a772415bf50 100644
--- a/src/main/java/net/minecraft/server/Blocks.java
+++ b/src/main/java/net/minecraft/server/Blocks.java
@@ -1,6 +1,8 @@
 package net.minecraft.server;
 
 import com.google.common.collect.UnmodifiableIterator;
+
+import java.io.File;
 import java.util.Iterator;
 import java.util.function.ToIntFunction;
 
@@ -31,7 +33,7 @@ public class Blocks {
     public static final Block JUNGLE_SAPLING = a("jungle_sapling", (Block) (new BlockSapling(new WorldGenMegaTreeProviderJungle(), BlockBase.Info.a(Material.PLANT).a().d().c().a(SoundEffectType.c))));
     public static final Block ACACIA_SAPLING = a("acacia_sapling", (Block) (new BlockSapling(new WorldGenTreeProviderAcacia(), BlockBase.Info.a(Material.PLANT).a().d().c().a(SoundEffectType.c))));
     public static final Block DARK_OAK_SAPLING = a("dark_oak_sapling", (Block) (new BlockSapling(new WorldGenMegaTreeProviderDarkOak(), BlockBase.Info.a(Material.PLANT).a().d().c().a(SoundEffectType.c))));
-    public static final Block BEDROCK = a("bedrock", new Block(BlockBase.Info.a(Material.STONE).a(-1.0F, 3600000.0F).f().a(Blocks::a)));
+    public static final Block BEDROCK = a("bedrock", new Block(BlockBase.Info.a(Material.STONE).a(-1.0F, 3600000.0F).f().a(Blocks::neverTypes))); // Purpur - decompile fix
     public static final Block WATER = a("water", (Block) (new BlockFluids(FluidTypes.WATER, BlockBase.Info.a(Material.WATER).a().d(100.0F).f())));
     public static final Block LAVA = a("lava", (Block) (new BlockFluids(FluidTypes.LAVA, BlockBase.Info.a(Material.LAVA).a().d().d(100.0F).a((iblockdata) -> {
         return 15;
@@ -75,7 +77,7 @@ public class Blocks {
     public static final Block DARK_OAK_LEAVES = a("dark_oak_leaves", (Block) b());
     public static final Block SPONGE = a("sponge", (Block) (new BlockSponge(BlockBase.Info.a(Material.SPONGE).d(0.6F).a(SoundEffectType.c))));
     public static final Block WET_SPONGE = a("wet_sponge", (Block) (new BlockWetSponge(BlockBase.Info.a(Material.SPONGE).d(0.6F).a(SoundEffectType.c))));
-    public static final Block GLASS = a("glass", (Block) (new BlockGlass(BlockBase.Info.a(Material.SHATTERABLE).d(0.3F).a(SoundEffectType.g).b().a(Blocks::a).a(Blocks::b).b(Blocks::b).c(Blocks::b))));
+    public static final Block GLASS = a("glass", (Block) (new BlockGlass(BlockBase.Info.a(Material.SHATTERABLE).d(0.3F).a(SoundEffectType.g).b().a(Blocks::neverTypes).a(Blocks::never).b(Blocks::b).c(Blocks::b)))); // Purpur - decompile fix
     public static final Block LAPIS_ORE = a("lapis_ore", (Block) (new BlockOre(BlockBase.Info.a(Material.STONE).h().a(3.0F, 3.0F))));
     public static final Block LAPIS_BLOCK = a("lapis_block", new Block(BlockBase.Info.a(Material.ORE, MaterialMapColor.H).h().a(3.0F, 3.0F)));
     public static final Block DISPENSER = a("dispenser", (Block) (new BlockDispenser(BlockBase.Info.a(Material.STONE).h().d(3.5F))));
@@ -126,7 +128,7 @@ public class Blocks {
     public static final Block GREEN_WOOL = a("green_wool", new Block(BlockBase.Info.a(Material.CLOTH, MaterialMapColor.C).d(0.8F).a(SoundEffectType.h)));
     public static final Block RED_WOOL = a("red_wool", new Block(BlockBase.Info.a(Material.CLOTH, MaterialMapColor.D).d(0.8F).a(SoundEffectType.h)));
     public static final Block BLACK_WOOL = a("black_wool", new Block(BlockBase.Info.a(Material.CLOTH, MaterialMapColor.E).d(0.8F).a(SoundEffectType.h)));
-    public static final Block MOVING_PISTON = a("moving_piston", (Block) (new BlockPistonMoving(BlockBase.Info.a(Material.PISTON).d(-1.0F).e().f().b().a(Blocks::b).b(Blocks::b).c(Blocks::b))));
+    public static final Block MOVING_PISTON = a("moving_piston", (Block) (new BlockPistonMoving(BlockBase.Info.a(Material.PISTON).d(-1.0F).e().f().b().a(Blocks::never).b(Blocks::b).c(Blocks::b)))); // Purpur - decompile fix
     public static final Block DANDELION = a("dandelion", (Block) (new BlockFlowers(MobEffects.SATURATION, 7, BlockBase.Info.a(Material.PLANT).a().c().a(SoundEffectType.c))));
     public static final Block POPPY = a("poppy", (Block) (new BlockFlowers(MobEffects.NIGHT_VISION, 5, BlockBase.Info.a(Material.PLANT).a().c().a(SoundEffectType.c))));
     public static final Block BLUE_ORCHID = a("blue_orchid", (Block) (new BlockFlowers(MobEffects.SATURATION, 7, BlockBase.Info.a(Material.PLANT).a().c().a(SoundEffectType.c))));
@@ -148,7 +150,7 @@ public class Blocks {
     public static final Block IRON_BLOCK = a("iron_block", new Block(BlockBase.Info.a(Material.ORE, MaterialMapColor.h).h().a(5.0F, 6.0F).a(SoundEffectType.f)));
     public static final Block BRICKS = a("bricks", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.D).h().a(2.0F, 6.0F)));
     public static final Block TNT = a("tnt", (Block) (new BlockTNT(BlockBase.Info.a(Material.TNT).c().a(SoundEffectType.c))));
-    public static final Block BOOKSHELF = a("bookshelf", new Block(BlockBase.Info.a(Material.WOOD).d(1.5F).a(SoundEffectType.a)));
+    public static final Block BOOKSHELF = a("bookshelf", shouldHaveBookshelfContainers() ? new BlockBookshelf(BlockBase.Info.a(Material.WOOD).d(1.5F).a(SoundEffectType.a)) : new Block(BlockBase.Info.a(Material.WOOD).d(1.5F).a(SoundEffectType.a))); // Purpur
     public static final Block MOSSY_COBBLESTONE = a("mossy_cobblestone", new Block(BlockBase.Info.a(Material.STONE).h().a(2.0F, 6.0F)));
     public static final Block OBSIDIAN = a("obsidian", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.E).h().a(50.0F, 1200.0F)));
     public static final Block TORCH = a("torch", (Block) (new BlockTorch(BlockBase.Info.a(Material.ORIENTABLE).a().c().a((iblockdata) -> {
@@ -216,7 +218,7 @@ public class Blocks {
     public static final Block OAK_FENCE = a("oak_fence", (Block) (new BlockFence(BlockBase.Info.a(Material.WOOD, Blocks.OAK_PLANKS.s()).a(2.0F, 3.0F).a(SoundEffectType.a))));
     public static final Block PUMPKIN = a("pumpkin", (Block) (new BlockPumpkin(BlockBase.Info.a(Material.PUMPKIN, MaterialMapColor.q).d(1.0F).a(SoundEffectType.a))));
     public static final Block NETHERRACK = a("netherrack", (Block) (new BlockNetherrack(BlockBase.Info.a(Material.STONE, MaterialMapColor.K).h().d(0.4F).a(SoundEffectType.K))));
-    public static final Block SOUL_SAND = a("soul_sand", (Block) (new BlockSlowSand(BlockBase.Info.a(Material.SAND, MaterialMapColor.B).d(0.5F).b(0.4F).a(SoundEffectType.G).a(Blocks::b).a(Blocks::a).c(Blocks::a).b(Blocks::a))));
+    public static final Block SOUL_SAND = a("soul_sand", (Block) (new BlockSlowSand(BlockBase.Info.a(Material.SAND, MaterialMapColor.B).d(0.5F).b(0.4F).a(SoundEffectType.G).a(Blocks::alwaysTypes).a(Blocks::always).c(Blocks::a).b(Blocks::a)))); // Purpur - decompile fix
     public static final Block SOUL_SOIL = a("soul_soil", new Block(BlockBase.Info.a(Material.EARTH, MaterialMapColor.B).d(0.5F).a(SoundEffectType.H)));
     public static final Block BASALT = a("basalt", (Block) (new BlockRotatable(BlockBase.Info.a(Material.STONE, MaterialMapColor.E).h().a(1.25F, 4.2F).a(SoundEffectType.I))));
     public static final Block cP = a("polished_basalt", (Block) (new BlockRotatable(BlockBase.Info.a(Material.STONE, MaterialMapColor.E).h().a(1.25F, 4.2F).a(SoundEffectType.I))));
@@ -232,10 +234,10 @@ public class Blocks {
     public static final Block NETHER_PORTAL = a("nether_portal", (Block) (new BlockPortal(BlockBase.Info.a(Material.PORTAL).a().d().d(-1.0F).a(SoundEffectType.g).a((iblockdata) -> {
         return 11;
     }))));
-    public static final Block CARVED_PUMPKIN = a("carved_pumpkin", (Block) (new BlockPumpkinCarved(BlockBase.Info.a(Material.PUMPKIN, MaterialMapColor.q).d(1.0F).a(SoundEffectType.a).a(Blocks::b))));
+    public static final Block CARVED_PUMPKIN = a("carved_pumpkin", (Block) (new BlockPumpkinCarved(BlockBase.Info.a(Material.PUMPKIN, MaterialMapColor.q).d(1.0F).a(SoundEffectType.a).a(Blocks::alwaysTypes)))); // Purpur - decompile fix
     public static final Block JACK_O_LANTERN = a("jack_o_lantern", (Block) (new BlockPumpkinCarved(BlockBase.Info.a(Material.PUMPKIN, MaterialMapColor.q).d(1.0F).a(SoundEffectType.a).a((iblockdata) -> {
         return 15;
-    }).a(Blocks::b))));
+    }).a(Blocks::alwaysTypes)))); // Purpur - decompile fix
     public static final Block CAKE = a("cake", (Block) (new BlockCake(BlockBase.Info.a(Material.CAKE).d(0.5F).a(SoundEffectType.h))));
     public static final Block REPEATER = a("repeater", (Block) (new BlockRepeater(BlockBase.Info.a(Material.ORIENTABLE).c().a(SoundEffectType.a))));
     public static final Block WHITE_STAINED_GLASS = a("white_stained_glass", (Block) b(EnumColor.WHITE));
@@ -254,12 +256,12 @@ public class Blocks {
     public static final Block GREEN_STAINED_GLASS = a("green_stained_glass", (Block) b(EnumColor.GREEN));
     public static final Block RED_STAINED_GLASS = a("red_stained_glass", (Block) b(EnumColor.RED));
     public static final Block BLACK_STAINED_GLASS = a("black_stained_glass", (Block) b(EnumColor.BLACK));
-    public static final Block OAK_TRAPDOOR = a("oak_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.o).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
-    public static final Block SPRUCE_TRAPDOOR = a("spruce_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.J).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
-    public static final Block BIRCH_TRAPDOOR = a("birch_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.d).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
-    public static final Block JUNGLE_TRAPDOOR = a("jungle_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.l).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
-    public static final Block ACACIA_TRAPDOOR = a("acacia_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.q).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
-    public static final Block DARK_OAK_TRAPDOOR = a("dark_oak_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.B).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
+    public static final Block OAK_TRAPDOOR = a("oak_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.o).d(3.0F).a(SoundEffectType.a).b().a(Blocks::never)))); // Purpur - decompile fix
+    public static final Block SPRUCE_TRAPDOOR = a("spruce_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.J).d(3.0F).a(SoundEffectType.a).b().a(Blocks::never)))); // Purpur - decompile fix
+    public static final Block BIRCH_TRAPDOOR = a("birch_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.d).d(3.0F).a(SoundEffectType.a).b().a(Blocks::never)))); // Purpur - decompile fix
+    public static final Block JUNGLE_TRAPDOOR = a("jungle_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.l).d(3.0F).a(SoundEffectType.a).b().a(Blocks::never)))); // Purpur - decompile fix
+    public static final Block ACACIA_TRAPDOOR = a("acacia_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.q).d(3.0F).a(SoundEffectType.a).b().a(Blocks::never)))); // Purpur - decompile fix
+    public static final Block DARK_OAK_TRAPDOOR = a("dark_oak_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.WOOD, MaterialMapColor.B).d(3.0F).a(SoundEffectType.a).b().a(Blocks::never)))); // Purpur - decompile fix
     public static final Block STONE_BRICKS = a("stone_bricks", new Block(BlockBase.Info.a(Material.STONE).h().a(1.5F, 6.0F)));
     public static final Block MOSSY_STONE_BRICKS = a("mossy_stone_bricks", new Block(BlockBase.Info.a(Material.STONE).h().a(1.5F, 6.0F)));
     public static final Block CRACKED_STONE_BRICKS = a("cracked_stone_bricks", new Block(BlockBase.Info.a(Material.STONE).h().a(1.5F, 6.0F)));
@@ -306,7 +308,7 @@ public class Blocks {
     public static final Block DRAGON_EGG = a("dragon_egg", (Block) (new BlockDragonEgg(BlockBase.Info.a(Material.DRAGON_EGG, MaterialMapColor.E).a(3.0F, 9.0F).a((iblockdata) -> {
         return 1;
     }).b())));
-    public static final Block REDSTONE_LAMP = a("redstone_lamp", (Block) (new BlockRedstoneLamp(BlockBase.Info.a(Material.BUILDABLE_GLASS).a(a(15)).d(0.3F).a(SoundEffectType.g).a(Blocks::b))));
+    public static final Block REDSTONE_LAMP = a("redstone_lamp", (Block) (new BlockRedstoneLamp(BlockBase.Info.a(Material.BUILDABLE_GLASS).a(a(15)).d(0.3F).a(SoundEffectType.g).a(Blocks::alwaysTypes)))); // Purpur - decompile fix
     public static final Block COCOA = a("cocoa", (Block) (new BlockCocoa(BlockBase.Info.a(Material.PLANT).d().a(0.2F, 3.0F).a(SoundEffectType.a).b())));
     public static final Block SANDSTONE_STAIRS = a("sandstone_stairs", (Block) (new BlockStairs(Blocks.SANDSTONE.getBlockData(), BlockBase.Info.a((BlockBase) Blocks.SANDSTONE))));
     public static final Block EMERALD_ORE = a("emerald_ore", (Block) (new BlockOre(BlockBase.Info.a(Material.STONE).h().a(3.0F, 3.0F))));
@@ -322,7 +324,7 @@ public class Blocks {
     public static final Block COMMAND_BLOCK = a("command_block", (Block) (new BlockCommand(BlockBase.Info.a(Material.ORE, MaterialMapColor.B).h().a(-1.0F, 3600000.0F).f())));
     public static final Block BEACON = a("beacon", (Block) (new BlockBeacon(BlockBase.Info.a(Material.SHATTERABLE, MaterialMapColor.G).d(3.0F).a((iblockdata) -> {
         return 15;
-    }).b().a(Blocks::b))));
+    }).b().a(Blocks::never)))); // Purpur - decompile fix
     public static final Block COBBLESTONE_WALL = a("cobblestone_wall", (Block) (new BlockCobbleWall(BlockBase.Info.a((BlockBase) Blocks.COBBLESTONE))));
     public static final Block MOSSY_COBBLESTONE_WALL = a("mossy_cobblestone_wall", (Block) (new BlockCobbleWall(BlockBase.Info.a((BlockBase) Blocks.COBBLESTONE))));
     public static final Block FLOWER_POT = a("flower_pot", (Block) (new BlockFlowerPot(Blocks.AIR, BlockBase.Info.a(Material.ORIENTABLE).c().b())));
@@ -378,7 +380,7 @@ public class Blocks {
     public static final Block HEAVY_WEIGHTED_PRESSURE_PLATE = a("heavy_weighted_pressure_plate", (Block) (new BlockPressurePlateWeighted(150, BlockBase.Info.a(Material.ORE).h().a().d(0.5F).a(SoundEffectType.a))));
     public static final Block COMPARATOR = a("comparator", (Block) (new BlockRedstoneComparator(BlockBase.Info.a(Material.ORIENTABLE).c().a(SoundEffectType.a))));
     public static final Block DAYLIGHT_DETECTOR = a("daylight_detector", (Block) (new BlockDaylightDetector(BlockBase.Info.a(Material.WOOD).d(0.2F).a(SoundEffectType.a))));
-    public static final Block REDSTONE_BLOCK = a("redstone_block", (Block) (new BlockPowered(BlockBase.Info.a(Material.ORE, MaterialMapColor.f).h().a(5.0F, 6.0F).a(SoundEffectType.f).a(Blocks::b))));
+    public static final Block REDSTONE_BLOCK = a("redstone_block", (Block) (new BlockPowered(BlockBase.Info.a(Material.ORE, MaterialMapColor.f).h().a(5.0F, 6.0F).a(SoundEffectType.f).a(Blocks::never)))); // Purpur - decompile fix
     public static final Block NETHER_QUARTZ_ORE = a("nether_quartz_ore", (Block) (new BlockOre(BlockBase.Info.a(Material.STONE, MaterialMapColor.K).h().a(3.0F, 3.0F).a(SoundEffectType.N))));
     public static final Block HOPPER = a("hopper", (Block) (new BlockHopper(BlockBase.Info.a(Material.ORE, MaterialMapColor.m).h().a(3.0F, 4.8F).a(SoundEffectType.f).b())));
     public static final Block QUARTZ_BLOCK = a("quartz_block", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.p).h().d(0.8F)));
@@ -422,8 +424,8 @@ public class Blocks {
     public static final Block ACACIA_STAIRS = a("acacia_stairs", (Block) (new BlockStairs(Blocks.ACACIA_PLANKS.getBlockData(), BlockBase.Info.a((BlockBase) Blocks.ACACIA_PLANKS))));
     public static final Block DARK_OAK_STAIRS = a("dark_oak_stairs", (Block) (new BlockStairs(Blocks.DARK_OAK_PLANKS.getBlockData(), BlockBase.Info.a((BlockBase) Blocks.DARK_OAK_PLANKS))));
     public static final Block SLIME_BLOCK = a("slime_block", (Block) (new BlockSlime(BlockBase.Info.a(Material.CLAY, MaterialMapColor.c).a(0.8F).a(SoundEffectType.m).b())));
-    public static final Block BARRIER = a("barrier", (Block) (new BlockBarrier(BlockBase.Info.a(Material.BANNER).a(-1.0F, 3600000.8F).f().b().a(Blocks::a))));
-    public static final Block IRON_TRAPDOOR = a("iron_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.ORE).h().d(5.0F).a(SoundEffectType.f).b().a(Blocks::a))));
+    public static final Block BARRIER = a("barrier", (Block) (new BlockBarrier(BlockBase.Info.a(Material.BANNER).a(-1.0F, 3600000.8F).f().b().a(Blocks::neverTypes)))); // Purpur - decompile fix
+    public static final Block IRON_TRAPDOOR = a("iron_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.ORE).h().d(5.0F).a(SoundEffectType.f).b().a(Blocks::neverTypes)))); // Purpur - decompile fix
     public static final Block PRISMARINE = a("prismarine", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.y).h().a(1.5F, 6.0F)));
     public static final Block PRISMARINE_BRICKS = a("prismarine_bricks", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.G).h().a(1.5F, 6.0F)));
     public static final Block DARK_PRISMARINE = a("dark_prismarine", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.G).h().a(1.5F, 6.0F)));
@@ -564,7 +566,7 @@ public class Blocks {
     public static final Block RED_NETHER_BRICKS = a("red_nether_bricks", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.K).h().a(2.0F, 6.0F).a(SoundEffectType.L)));
     public static final Block BONE_BLOCK = a("bone_block", (Block) (new BlockRotatable(BlockBase.Info.a(Material.STONE, MaterialMapColor.d).h().d(2.0F).a(SoundEffectType.O))));
     public static final Block STRUCTURE_VOID = a("structure_void", (Block) (new BlockStructureVoid(BlockBase.Info.a(Material.STRUCTURE_VOID).a().f())));
-    public static final Block OBSERVER = a("observer", (Block) (new BlockObserver(BlockBase.Info.a(Material.STONE).d(3.0F).h().a(Blocks::b))));
+    public static final Block OBSERVER = a("observer", (Block) (new BlockObserver(BlockBase.Info.a(Material.STONE).d(3.0F).h().a(Blocks::never)))); // Purpur - decompile fix
     public static final Block SHULKER_BOX = a("shulker_box", (Block) a((EnumColor) null, BlockBase.Info.a(Material.SHULKER_SHELL)));
     public static final Block WHITE_SHULKER_BOX = a("white_shulker_box", (Block) a(EnumColor.WHITE, BlockBase.Info.a(Material.SHULKER_SHELL, MaterialMapColor.j)));
     public static final Block ORANGE_SHULKER_BOX = a("orange_shulker_box", (Block) a(EnumColor.ORANGE, BlockBase.Info.a(Material.SHULKER_SHELL, MaterialMapColor.q)));
@@ -782,8 +784,8 @@ public class Blocks {
     public static final Block WARPED_PRESSURE_PLATE = a("warped_pressure_plate", (Block) (new BlockPressurePlateBinary(BlockPressurePlateBinary.EnumMobType.EVERYTHING, BlockBase.Info.a(Material.NETHER_WOOD, Blocks.WARPED_PLANKS.s()).a().d(0.5F).a(SoundEffectType.a))));
     public static final Block CRIMSON_FENCE = a("crimson_fence", (Block) (new BlockFence(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.CRIMSON_PLANKS.s()).a(2.0F, 3.0F).a(SoundEffectType.a))));
     public static final Block WARPED_FENCE = a("warped_fence", (Block) (new BlockFence(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.WARPED_PLANKS.s()).a(2.0F, 3.0F).a(SoundEffectType.a))));
-    public static final Block CRIMSON_TRAPDOOR = a("crimson_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.CRIMSON_PLANKS.s()).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
-    public static final Block WARPED_TRAPDOOR = a("warped_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.WARPED_PLANKS.s()).d(3.0F).a(SoundEffectType.a).b().a(Blocks::a))));
+    public static final Block CRIMSON_TRAPDOOR = a("crimson_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.CRIMSON_PLANKS.s()).d(3.0F).a(SoundEffectType.a).b().a(Blocks::neverTypes)))); // Purpur - decompile fix
+    public static final Block WARPED_TRAPDOOR = a("warped_trapdoor", (Block) (new BlockTrapdoor(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.WARPED_PLANKS.s()).d(3.0F).a(SoundEffectType.a).b().a(Blocks::neverTypes)))); // Purpur - decompile fix
     public static final Block CRIMSON_FENCE_GATE = a("crimson_fence_gate", (Block) (new BlockFenceGate(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.CRIMSON_PLANKS.s()).a(2.0F, 3.0F).a(SoundEffectType.a))));
     public static final Block WARPED_FENCE_GATE = a("warped_fence_gate", (Block) (new BlockFenceGate(BlockBase.Info.a(Material.NETHER_WOOD, Blocks.WARPED_PLANKS.s()).a(2.0F, 3.0F).a(SoundEffectType.a))));
     public static final Block CRIMSON_STAIRS = a("crimson_stairs", (Block) (new BlockStairs(Blocks.CRIMSON_PLANKS.getBlockData(), BlockBase.Info.a((BlockBase) Blocks.CRIMSON_PLANKS))));
@@ -838,16 +840,25 @@ public class Blocks {
     public static final Block CRACKED_NETHER_BRICKS = a("cracked_nether_bricks", new Block(BlockBase.Info.a(Material.STONE, MaterialMapColor.K).h().a(2.0F, 6.0F).a(SoundEffectType.L)));
     public static final Block QUARTZ_BRICKS = a("quartz_bricks", new Block(BlockBase.Info.a((BlockBase) Blocks.QUARTZ_BLOCK)));
 
+    // Purpur start
+    private static boolean shouldHaveBookshelfContainers() {
+        net.pl3x.purpur.PurpurConfig.init(org.bukkit.craftbukkit.Main.purpurConfig);
+        return net.pl3x.purpur.PurpurConfig.bookshelfContainers;
+    }
+    // Purpur end
+
     private static ToIntFunction<IBlockData> a(int i) {
         return (iblockdata) -> {
             return (Boolean) iblockdata.get(BlockProperties.r) ? i : 0;
         };
     }
 
+    private static Boolean neverTypes(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition, EntityTypes<?> entitytypes) { return a(iblockdata, iblockaccess, blockposition, entitytypes); } // Purpur - OBFHELPER
     private static Boolean a(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition, EntityTypes<?> entitytypes) {
         return false;
     }
 
+    private static Boolean alwaysTypes(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition, EntityTypes<?> entitytypes) { return b(iblockdata, iblockaccess, blockposition, entitytypes); } // Purpur - OBFHELPER
     private static Boolean b(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition, EntityTypes<?> entitytypes) {
         return true;
     }
@@ -874,20 +885,22 @@ public class Blocks {
         }).d(2.0F).a(SoundEffectType.z));
     }
 
+    private static boolean always(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition) { return a(iblockdata, iblockaccess, blockposition); } // Purpur - OBFHELPER
     private static boolean a(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition) {
         return true;
     }
 
+    private static boolean never(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition) { return b(iblockdata, iblockaccess, blockposition); } // Purpur - OBFHELPER
     private static boolean b(IBlockData iblockdata, IBlockAccess iblockaccess, BlockPosition blockposition) {
         return false;
     }
 
     private static BlockStainedGlass b(EnumColor enumcolor) {
-        return new BlockStainedGlass(enumcolor, BlockBase.Info.a(Material.SHATTERABLE, enumcolor).d(0.3F).a(SoundEffectType.g).b().a(Blocks::a).a(Blocks::b).b(Blocks::b).c(Blocks::b));
+        return new BlockStainedGlass(enumcolor, BlockBase.Info.a(Material.SHATTERABLE, enumcolor).d(0.3F).a(SoundEffectType.g).b().a(Blocks::neverTypes).a(Blocks::never).b(Blocks::b).c(Blocks::b));
     }
 
     private static BlockLeaves b() {
-        return new BlockLeaves(BlockBase.Info.a(Material.LEAVES).d(0.2F).d().a(SoundEffectType.c).b().a(Blocks::c).b(Blocks::b).c(Blocks::b));
+        return new BlockLeaves(BlockBase.Info.a(Material.LEAVES).d(0.2F).d().a(SoundEffectType.c).b().a(Blocks::c).b(Blocks::b).c(Blocks::b)); // Purpur - decompile fix
     }
 
     private static BlockShulkerBox a(EnumColor enumcolor, BlockBase.Info blockbase_info) {
@@ -911,7 +924,7 @@ public class Blocks {
             return !(Boolean) iblockdata.get(BlockPiston.EXTENDED);
         };
 
-        return new BlockPiston(flag, BlockBase.Info.a(Material.PISTON).d(1.5F).a(Blocks::b).b(blockbase_e).c(blockbase_e));
+        return new BlockPiston(flag, BlockBase.Info.a(Material.PISTON).d(1.5F).a(Blocks::never).b(blockbase_e).c(blockbase_e)); // Purpur - decompile fix
     }
 
     private static Block a(String s, Block block) {
diff --git a/src/main/java/net/minecraft/server/Chunk.java b/src/main/java/net/minecraft/server/Chunk.java
index 6cde93d62c4c324a6544401cabe045cbb80f465e..fc51792faccf3f997da141d631d3a1277ad3a80e 100644
--- a/src/main/java/net/minecraft/server/Chunk.java
+++ b/src/main/java/net/minecraft/server/Chunk.java
@@ -881,6 +881,7 @@ public class Chunk implements IChunkAccess {
 
     @Override
     public void setTileEntity(BlockPosition blockposition, TileEntity tileentity) {
+        if (!net.pl3x.purpur.PurpurConfig.bookshelfContainers && this.getType(blockposition).getBukkitMaterial() == org.bukkit.Material.BOOKSHELF) return; // Purpur
         if (this.getType(blockposition).getBlock() instanceof ITileEntity) {
             tileentity.setLocation(this.world, blockposition);
             tileentity.r();
diff --git a/src/main/java/net/minecraft/server/TileEntityBookshelf.java b/src/main/java/net/minecraft/server/TileEntityBookshelf.java
new file mode 100644
index 0000000000000000000000000000000000000000..d6fb27ea7976b2a6f9eed4cf8f87c560719c3cd3
--- /dev/null
+++ b/src/main/java/net/minecraft/server/TileEntityBookshelf.java
@@ -0,0 +1,111 @@
+package net.minecraft.server;
+
+import net.pl3x.purpur.PurpurConfig;
+import org.bukkit.craftbukkit.entity.CraftHumanEntity;
+import org.bukkit.entity.HumanEntity;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class TileEntityBookshelf extends TileEntityLootable {
+    public List<HumanEntity> transaction = new ArrayList<>();
+
+    private int maxStack = MAX_STACK;
+    private NonNullList<ItemStack> items;
+
+    protected TileEntityBookshelf(TileEntityTypes<?> types) {
+        super(types);
+        this.items = NonNullList.a(9, ItemStack.NULL_ITEM);
+    }
+
+    public TileEntityBookshelf() {
+        this(TileEntityTypes.BOOKSHELF);
+    }
+
+    @Override
+    public int getSize() {
+        return 9;
+    }
+
+    @Override
+    public int getMaxStackSize() {
+        return maxStack;
+    }
+
+    @Override
+    public List<ItemStack> getContents() {
+        return this.items;
+    }
+
+    @Override
+    public void onOpen(CraftHumanEntity who) {
+        this.transaction.add(who);
+    }
+
+    @Override
+    public void onClose(CraftHumanEntity who) {
+        transaction.remove(who);
+    }
+
+    @Override
+    public List<HumanEntity> getViewers() {
+        return transaction;
+    }
+
+    @Override
+    public void setMaxStackSize(int size) {
+        this.maxStack = size;
+    }
+
+    public int addItem(ItemStack itemStack) {
+        for (int i = 0; i < this.items.size(); ++i) {
+            if ((this.items.get(i)).isEmpty()) {
+                this.setItem(i, itemStack);
+                return i;
+            }
+        }
+
+        return -1;
+    }
+
+
+    @Override
+    protected IChatBaseComponent getContainerName() {
+        return new ChatMessage(PurpurConfig.bookshelfContainerNames);
+    }
+
+    @Override
+    protected Container createContainer(int i, PlayerInventory playerinventory) {
+        return new ContainerDispenser(i, playerinventory, this);
+    }
+
+    @Override
+    public void load(IBlockData iblockdata, NBTTagCompound nbttagcompound) {
+        super.load(iblockdata, nbttagcompound);
+        this.items = NonNullList.a(this.getSize(), ItemStack.NULL_ITEM);
+        if (!this.tryLoadLootTable(nbttagcompound)) {
+            ContainerUtil.b(nbttagcompound, this.items);
+        }
+
+    }
+
+    @Override
+    public NBTTagCompound save(NBTTagCompound nbttagcompound) {
+        super.save(nbttagcompound);
+        if (!this.trySaveLootTable(nbttagcompound)) {
+            ContainerUtil.a(nbttagcompound, this.items);
+        }
+
+        return nbttagcompound;
+    }
+
+    @Override
+    protected NonNullList<ItemStack> f() {
+        return this.items;
+    }
+
+    @Override
+    protected void a(NonNullList<ItemStack> items) {
+        this.items = items;
+    }
+}
diff --git a/src/main/java/net/minecraft/server/TileEntityLootable.java b/src/main/java/net/minecraft/server/TileEntityLootable.java
index c6df2318762dc6542e73f18ed9a3172ee31d96ee..59483504f7bd2e0f44aca8b1d66c49805db9d483 100644
--- a/src/main/java/net/minecraft/server/TileEntityLootable.java
+++ b/src/main/java/net/minecraft/server/TileEntityLootable.java
@@ -23,6 +23,7 @@ public abstract class TileEntityLootable extends TileEntityContainer {
 
     }
 
+    protected boolean tryLoadLootTable(NBTTagCompound nbttagcompound) { return this.b(nbttagcompound); } // Purpur - OBFHELPER
     protected boolean b(NBTTagCompound nbttagcompound) {
         this.lootableData.loadNbt(nbttagcompound); // Paper
         if (nbttagcompound.hasKeyOfType("LootTable", 8)) {
@@ -35,6 +36,7 @@ public abstract class TileEntityLootable extends TileEntityContainer {
         }
     }
 
+    protected boolean trySaveLootTable(NBTTagCompound nbttagcompound) { return this.c(nbttagcompound); } // Purpur - OBFHELPER
     protected boolean c(NBTTagCompound nbttagcompound) {
         this.lootableData.saveNbt(nbttagcompound); // Paper
         if (this.lootTable == null) {
diff --git a/src/main/java/net/minecraft/server/TileEntityTypes.java b/src/main/java/net/minecraft/server/TileEntityTypes.java
index 5fc302bf0631d4e0b887b7c2a4e0e5a3c78d6875..e98b197e9242a8cc62b207b75b7dca8d59cc2b7f 100644
--- a/src/main/java/net/minecraft/server/TileEntityTypes.java
+++ b/src/main/java/net/minecraft/server/TileEntityTypes.java
@@ -44,6 +44,7 @@ public class TileEntityTypes<T extends TileEntity> {
     public static final TileEntityTypes<TileEntityJigsaw> JIGSAW = a("jigsaw", TileEntityTypes.a.a(TileEntityJigsaw::new, Blocks.JIGSAW));
     public static final TileEntityTypes<TileEntityCampfire> CAMPFIRE = a("campfire", TileEntityTypes.a.a(TileEntityCampfire::new, Blocks.CAMPFIRE, Blocks.SOUL_CAMPFIRE));
     public static final TileEntityTypes<TileEntityBeehive> BEEHIVE = a("beehive", TileEntityTypes.a.a(TileEntityBeehive::new, Blocks.BEE_NEST, Blocks.BEEHIVE));
+    public static final TileEntityTypes<TileEntityBookshelf> BOOKSHELF = a("bookshelf", TileEntityTypes.a.a(TileEntityBookshelf::new, Blocks.BOOKSHELF)); // Purpur
     private final Supplier<? extends T> I;
     private final Set<Block> J;
     private final Type<?> K;
@@ -60,7 +61,7 @@ public class TileEntityTypes<T extends TileEntity> {
 
         Type<?> type = SystemUtils.a(DataConverterTypes.BLOCK_ENTITY, s);
 
-        return (TileEntityTypes) IRegistry.a(IRegistry.BLOCK_ENTITY_TYPE, s, (Object) tileentitytypes_a.a(type));
+        return (TileEntityTypes) IRegistry.a(IRegistry.BLOCK_ENTITY_TYPE, s, tileentitytypes_a.a(type)); // Purpur - decompile fix
     }
 
     public TileEntityTypes(Supplier<? extends T> supplier, Set<Block> set, Type<?> type) {
@@ -71,7 +72,7 @@ public class TileEntityTypes<T extends TileEntity> {
 
     @Nullable
     public T a() {
-        return (TileEntity) this.I.get();
+        return this.I.get(); // Purpur - decompile fix
     }
 
     public boolean isValidBlock(Block block) {
@@ -82,7 +83,7 @@ public class TileEntityTypes<T extends TileEntity> {
     public T a(IBlockAccess iblockaccess, BlockPosition blockposition) {
         TileEntity tileentity = iblockaccess.getTileEntity(blockposition);
 
-        return tileentity != null && tileentity.getTileType() == this ? tileentity : null;
+        return tileentity != null && tileentity.getTileType() == this ? (T) tileentity : null; // Purpur - decompile fix
     }
 
     public static final class a<T extends TileEntity> {
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index 5d75481660d5e11abe263f2a6343b87c75cca090..2edbed5f2eaa95f8756c2d728fc1ad24131403bd 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -212,6 +212,8 @@ public class PurpurConfig {
     public static boolean enderChestSixRows = false;
     public static boolean enderChestPermissionRows = false;
     public static boolean cryingObsidianValidForPortalFrame = false;
+    public static boolean bookshelfContainers = false;
+    public static String bookshelfContainerNames = "Bookshelf";
     private static void blockSettings() {
         if (version < 3) {
             boolean oldValue = getBoolean("settings.barrel.packed-barrels", true);
@@ -227,6 +229,8 @@ public class PurpurConfig {
         InventoryType.ENDER_CHEST.setDefaultSize(enderChestSixRows ? 54 : 27);
         enderChestPermissionRows = getBoolean("settings.blocks.ender_chest.use-permissions-for-rows", enderChestPermissionRows);
         cryingObsidianValidForPortalFrame = getBoolean("settings.blocks.crying_obsidian.valid-for-portal-frame", cryingObsidianValidForPortalFrame);
+        bookshelfContainers = getBoolean("settings.blocks.bookshelf.containers", bookshelfContainers);
+        bookshelfContainerNames = getString("settings.blocks.bookshelf.container-name", bookshelfContainerNames);
     }
 
     public static boolean allowInfinityMending = false;
diff --git a/src/main/java/org/bukkit/craftbukkit/Main.java b/src/main/java/org/bukkit/craftbukkit/Main.java
index b10873022efc8f01ef172e86cad07831d7bf0d5e..98a12348dd4c5e892d8fba4523dc59f75f7ee59a 100644
--- a/src/main/java/org/bukkit/craftbukkit/Main.java
+++ b/src/main/java/org/bukkit/craftbukkit/Main.java
@@ -17,6 +17,7 @@ import net.minecrell.terminalconsole.TerminalConsoleAppender; // Paper
 public class Main {
     public static boolean useJline = true;
     public static boolean useConsole = true;
+    public static File purpurConfig; // Purpur
 
     public static void main(String[] args) {
         // Todo: Installation script
@@ -247,6 +248,8 @@ public class Main {
                 }
                 */
 
+                purpurConfig = (File) options.valueOf("purpur-settings"); // Purpur
+
                 if (options.has("nojline")) {
                     System.setProperty(TerminalConsoleAppender.JLINE_OVERRIDE_PROPERTY, "false");
                     useJline = false;
