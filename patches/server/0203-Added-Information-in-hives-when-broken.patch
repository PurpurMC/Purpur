From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: DoctaEnkoda <bierquejason@gmail.com>
Date: Thu, 29 Apr 2021 20:37:20 +0200
Subject: [PATCH] Added Information in hives when broken


diff --git a/src/main/java/net/minecraft/world/level/block/BlockBeehive.java b/src/main/java/net/minecraft/world/level/block/BlockBeehive.java
index 828d231a963f1962d88fe170ac86590d86e1df40..55a362742817a557751fdc42fcbe154d5e54c52e 100644
--- a/src/main/java/net/minecraft/world/level/block/BlockBeehive.java
+++ b/src/main/java/net/minecraft/world/level/block/BlockBeehive.java
@@ -12,6 +12,10 @@ import net.minecraft.core.BlockPosition;
 import net.minecraft.core.EnumDirection;
 import net.minecraft.nbt.NBTBase;
 import net.minecraft.nbt.NBTTagCompound;
+import net.minecraft.nbt.NBTTagList;
+import net.minecraft.nbt.NBTTagString;
+import net.minecraft.network.chat.ChatComponentText;
+import net.minecraft.network.chat.IChatBaseComponent;
 import net.minecraft.server.MCUtil;
 import net.minecraft.server.level.EntityPlayer;
 import net.minecraft.sounds.SoundCategory;
@@ -49,6 +53,7 @@ import net.minecraft.world.level.storage.loot.LootTableInfo;
 import net.minecraft.world.level.storage.loot.parameters.LootContextParameters;
 import net.minecraft.world.phys.AxisAlignedBB;
 import net.minecraft.world.phys.MovingObjectPositionBlock;
+import net.pl3x.purpur.PurpurConfig;
 
 public class BlockBeehive extends BlockTileEntity {
 
@@ -238,9 +243,35 @@ public class BlockBeehive extends BlockTileEntity {
                     itemstack.a("BlockEntityTag", (NBTBase) nbttagcompound);
                 }
 
+                // Purpur Start - Add Lore when BeeHive / BeeNest break
+                NBTTagCompound display = new NBTTagCompound();
+                if (PurpurConfig.addLoreHoneyLevelWhenBreak || PurpurConfig.addLoreNumberBeesInBeehiveWhenBreak) {
+                    NBTTagList information_bees_in_lore = new NBTTagList();
+
+                    if (PurpurConfig.addLoreNumberBeesInBeehiveWhenBreak) {
+                        information_bees_in_lore.add(NBTTagString.a(IChatBaseComponent.ChatSerializer.a(new ChatComponentText(
+                                String.format(PurpurConfig.formatLoreNumberBeesInBeehive, tileentitybeehive.getBeeCount())))));
+                    }
+                    if (PurpurConfig.addLoreHoneyLevelWhenBreak) {
+                        information_bees_in_lore.add(NBTTagString.a(IChatBaseComponent.ChatSerializer.a(new ChatComponentText(
+                                String.format(PurpurConfig.formatLoreNumberHoneyLevelInBeehive, i)
+                        ))));
+                    }
+
+                    display.set("Lore", information_bees_in_lore);
+                }
+                // Purpur Stop
+
                 nbttagcompound = new NBTTagCompound();
                 nbttagcompound.setInt("honey_level", i);
                 itemstack.a("BlockStateTag", (NBTBase) nbttagcompound);
+
+                // Purpur Start - Add Lore when BeeHive / BeeNest break
+                if (PurpurConfig.addLoreHoneyLevelWhenBreak || PurpurConfig.addLoreNumberBeesInBeehiveWhenBreak) {
+                    itemstack.a("display", display);
+                }
+                // Purpur Stop
+
                 EntityItem entityitem = new EntityItem(world, (double) blockposition.getX(), (double) blockposition.getY(), (double) blockposition.getZ(), itemstack);
 
                 entityitem.defaultPickupDelay();
@@ -265,7 +296,39 @@ public class BlockBeehive extends BlockTileEntity {
             }
         }
 
-        return super.a(iblockdata, loottableinfo_builder);
+        // Purpur Start - Add Lore when BeeHive / BeeNest break
+        if (PurpurConfig.addLoreHoneyLevelWhenBreak || PurpurConfig.addLoreNumberBeesInBeehiveWhenBreak) {
+            TileEntity tileentity = (TileEntity) loottableinfo_builder.b(LootContextParameters.BLOCK_ENTITY);
+            List<ItemStack> loots = super.a(iblockdata, loottableinfo_builder);
+            if (tileentity instanceof TileEntityBeehive) {
+                TileEntityBeehive tileentitybeehive = (TileEntityBeehive) tileentity;
+                if (!tileentitybeehive.isEmpty()) {
+                    for (ItemStack loot : loots) {
+                        if (loot.getItem().equals(Items.rs) || loot.getItem().equals(Items.rr)) {
+                            NBTTagCompound display = new NBTTagCompound();
+                            NBTTagList information_bees_in_lore = new NBTTagList();
+
+                            if (PurpurConfig.addLoreNumberBeesInBeehiveWhenBreak) {
+                                information_bees_in_lore.add(NBTTagString.a(IChatBaseComponent.ChatSerializer.a(new ChatComponentText(
+                                        String.format(PurpurConfig.formatLoreNumberBeesInBeehive, tileentitybeehive.getBeeCount())))));
+                            }
+                            if (PurpurConfig.addLoreHoneyLevelWhenBreak) {
+                                information_bees_in_lore.add(NBTTagString.a(IChatBaseComponent.ChatSerializer.a(new ChatComponentText(
+                                        String.format(PurpurConfig.formatLoreNumberHoneyLevelInBeehive, iblockdata.get(BlockBeehive.b))
+                                ))));
+                            }
+
+                            display.set("Lore", information_bees_in_lore);
+                            loot.a("display", display);
+                        }
+                    }
+                }
+            }
+            return loots;
+        } else {
+            return super.a(iblockdata, loottableinfo_builder);
+        }
+        // Purpur Stop
     }
 
     @Override
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index c0ef121956ad42bbb555eb8ee6c46b1845dd9e0d..9516d12114b2d8e355ecc1b0107d8a44623f8045 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -214,6 +214,10 @@ public class PurpurConfig {
     public static boolean enderChestPermissionRows = false;
     public static boolean cryingObsidianValidForPortalFrame = false;
     public static int beeInsideBeeHive = 3;
+    public static boolean addLoreNumberBeesInBeehiveWhenBreak = false;
+    public static boolean addLoreHoneyLevelWhenBreak = false;
+    public static String formatLoreNumberBeesInBeehive = "§rBees : %d";
+    public static String formatLoreNumberHoneyLevelInBeehive = "§rHoney Level : %d";
     private static void blockSettings() {
         if (version < 3) {
             boolean oldValue = getBoolean("settings.barrel.packed-barrels", true);
@@ -230,6 +234,10 @@ public class PurpurConfig {
         enderChestPermissionRows = getBoolean("settings.blocks.ender_chest.use-permissions-for-rows", enderChestPermissionRows);
         cryingObsidianValidForPortalFrame = getBoolean("settings.blocks.crying_obsidian.valid-for-portal-frame", cryingObsidianValidForPortalFrame);
         beeInsideBeeHive = getInt("settings.blocks.beehive.max-bees-inside", beeInsideBeeHive);
+        addLoreNumberBeesInBeehiveWhenBreak = getBoolean("settings.blocks.beehive.add-number-bees-inside-beehive-when-break", addLoreNumberBeesInBeehiveWhenBreak);
+        addLoreHoneyLevelWhenBreak = getBoolean("settings.blocks.beehive.add-honey-level-inside-beehive-when-break", addLoreHoneyLevelWhenBreak);
+        formatLoreNumberBeesInBeehive = getString("settings.blocks.beehive.bees-inside-in-lore-when-break", formatLoreNumberBeesInBeehive);
+        formatLoreNumberHoneyLevelInBeehive = getString("settings.blocks.beehive.honey-level-in-lore-when-break", formatLoreNumberHoneyLevelInBeehive);
     }
 
     public static boolean allowInfinityMending = false;
