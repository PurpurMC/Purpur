From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: rafaelflromao <12960698+rafaelflromao@users.noreply.github.com>
Date: Sun, 7 May 2023 23:47:17 +0100
Subject: [PATCH] Add mending multiplier


diff --git a/src/main/java/net/minecraft/world/entity/ExperienceOrb.java b/src/main/java/net/minecraft/world/entity/ExperienceOrb.java
index df8d8f85f8db396b7db9fa6e46aa55c934105394..5a6c09feb727029f9554d3b8c9d088b0f3932b04 100644
--- a/src/main/java/net/minecraft/world/entity/ExperienceOrb.java
+++ b/src/main/java/net/minecraft/world/entity/ExperienceOrb.java
@@ -327,7 +327,11 @@ public class ExperienceOrb extends Entity {
 
         if (entry != null) {
             ItemStack itemstack = (ItemStack) entry.getValue();
-            int j = Math.min(this.xpToDurability(this.value), itemstack.getDamageValue());
+            // Purpur start
+            int durability = (int) Math.round(this.xpToDurability(this.value) * level.purpurConfig.mendingMultiplier);
+            // Purpur end
+            int j = Math.min(durability, itemstack.getDamageValue());
+
             // CraftBukkit start
             org.bukkit.event.player.PlayerItemMendEvent event = CraftEventFactory.callPlayerItemMendEvent(player, this, itemstack, entry.getKey(), j);
             j = event.getRepairAmount();
diff --git a/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java b/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
index 157c5ce26015cabd5a007cf7444c8255db1a0b0f..31622937846c14dab4177a1f08c15985957c98bb 100644
--- a/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
+++ b/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
@@ -121,6 +121,7 @@ public class PurpurWorldConfig {
     }
 
     public boolean useBetterMending = false;
+    public double mendingMultiplier = 1.0;
     public boolean alwaysTameInCreative = false;
     public boolean boatEjectPlayersOnLand = false;
     public boolean boatsDoFallDamage = false;
@@ -148,6 +149,7 @@ public class PurpurWorldConfig {
     public int mobLastHurtByPlayerTime = 100;
     private void miscGameplayMechanicsSettings() {
         useBetterMending = getBoolean("gameplay-mechanics.use-better-mending", useBetterMending);
+        mendingMultiplier = getDouble("gameplay-mechanics.mending-multiplier", mendingMultiplier);
         alwaysTameInCreative = getBoolean("gameplay-mechanics.always-tame-in-creative", alwaysTameInCreative);
         boatEjectPlayersOnLand = getBoolean("gameplay-mechanics.boat.eject-players-on-land", boatEjectPlayersOnLand);
         boatsDoFallDamage = getBoolean("gameplay-mechanics.boat.do-fall-damage", boatsDoFallDamage);
