From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Minh Nguyen <minhh2792.work@gmail.com>
Date: Thu, 24 Mar 2022 04:27:22 +0000
Subject: [PATCH] Configurable map update interval


diff --git a/src/main/java/net/minecraft/world/level/saveddata/maps/MapItemSavedData.java b/src/main/java/net/minecraft/world/level/saveddata/maps/MapItemSavedData.java
index 6a78374b6ab3198571df7e17023d371667ebb24b..19d9fe2302a7acb9f4aec0e80ce81354248ed0f0 100644
--- a/src/main/java/net/minecraft/world/level/saveddata/maps/MapItemSavedData.java
+++ b/src/main/java/net/minecraft/world/level/saveddata/maps/MapItemSavedData.java
@@ -624,7 +624,7 @@ public class MapItemSavedData extends SavedData {
         @Nullable
         Packet<?> nextUpdatePacket(int mapId) {
             MapItemSavedData.MapPatch worldmap_b;
-            if (!this.dirtyData && this.tick % 5 != 0) { this.tick++; return null; } // Paper - this won't end up sending, so don't render it!
+            if (!this.dirtyData && this.tick % org.purpurmc.purpur.PurpurConfig.mapUpdateInterval != 0) { this.tick++; return null; } // Paper - this won't end up sending, so don't render it! // Purpur - configurable map update interval
             boolean vanillaMaps = shouldUseVanillaMap(); // Paper
             org.bukkit.craftbukkit.map.RenderData render = !vanillaMaps ? MapItemSavedData.this.mapView.render((org.bukkit.craftbukkit.entity.CraftPlayer) this.player.getBukkitEntity()) : MapItemSavedData.this.vanillaRender; // CraftBukkit // Paper
 
@@ -637,7 +637,7 @@ public class MapItemSavedData extends SavedData {
 
             Collection collection;
 
-            if ((true || this.dirtyDecorations) && this.tick++ % 5 == 0) { // CraftBukkit - custom maps don't update this yet
+            if ((true || this.dirtyDecorations) && this.tick++ % org.purpurmc.purpur.PurpurConfig.mapUpdateInterval == 0) { // CraftBukkit - custom maps don't update this yet // Purpur - configurable map update interval
                 this.dirtyDecorations = false;
                 // CraftBukkit start
                 java.util.Collection<MapDecoration> icons = new java.util.ArrayList<MapDecoration>();
diff --git a/src/main/java/org/purpurmc/purpur/PurpurConfig.java b/src/main/java/org/purpurmc/purpur/PurpurConfig.java
index 659e93fb24124318367e5b4d0b144ca1443950e9..6a37582f563dd3eaf16a9bb434490decd03b25dc 100644
--- a/src/main/java/org/purpurmc/purpur/PurpurConfig.java
+++ b/src/main/java/org/purpurmc/purpur/PurpurConfig.java
@@ -72,8 +72,8 @@ public class PurpurConfig {
         commands = new HashMap<>();
         commands.put("purpur", new PurpurCommand("purpur"));
 
-        version = getInt("config-version", 27);
-        set("config-version", 27);
+        version = getInt("config-version", 28);
+        set("config-version", 28);
 
         readConfig(PurpurConfig.class, null);
     }
@@ -427,6 +427,11 @@ public class PurpurConfig {
         tpsCatchup = getBoolean("settings.tps-catchup", tpsCatchup);
     }
 
+    public static int mapUpdateInterval = 5;
+    private static void mapUpdateInterval() {
+        mapUpdateInterval = getInt("settings.map-update-interval", mapUpdateInterval);
+    }
+
     public static boolean useUPnP = false;
     public static boolean maxJoinsPerSecond = false;
     private static void networkSettings() {
