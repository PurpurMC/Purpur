From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <Blake.Galbreath@GMail.com>
Date: Fri, 7 Aug 2020 12:53:36 -0500
Subject: [PATCH] Add no-tick block list


diff --git a/src/main/java/net/minecraft/server/level/WorldServer.java b/src/main/java/net/minecraft/server/level/WorldServer.java
index bdc1aaa02836cb675224062e59cd635c6fe6e28a..3341a82207ac02be2be8d8baf5a10da183445a7e 100644
--- a/src/main/java/net/minecraft/server/level/WorldServer.java
+++ b/src/main/java/net/minecraft/server/level/WorldServer.java
@@ -532,14 +532,14 @@ public class WorldServer extends World implements GeneratorAccessSeed {
         // CraftBukkit end
         if (com.destroystokyo.paper.PaperConfig.useOptimizedTickList) {
             this.nextTickListBlock = new com.destroystokyo.paper.server.ticklist.PaperTickList<>(this, (block) -> {
-                return block == null || block.getBlockData().isAir();
+                return block == null || block.getBlockData().isAir() || purpurConfig.noTickBlocks.contains(block); // Purpur
             }, IRegistry.BLOCK::getKey, this::b, "Blocks"); // Paper - Timings
             this.nextTickListFluid = new com.destroystokyo.paper.server.ticklist.PaperTickList<>(this, (fluidtype) -> {
                 return fluidtype == null || fluidtype == FluidTypes.EMPTY;
             }, IRegistry.FLUID::getKey, this::a, "Fluids"); // Paper - Timings
         } else {
             this.nextTickListBlock = new TickListServer<>(this, (block) -> {
-                return block == null || block.getBlockData().isAir();
+                return block == null || block.getBlockData().isAir() || purpurConfig.noTickBlocks.contains(block); // Purpur
             }, IRegistry.BLOCK::getKey, this::b, "Blocks"); // Paper - Timings
             this.nextTickListFluid = new TickListServer<>(this, (fluidtype) -> {
                 return fluidtype == null || fluidtype == FluidTypes.EMPTY;
diff --git a/src/main/java/net/minecraft/world/level/block/state/BlockBase.java b/src/main/java/net/minecraft/world/level/block/state/BlockBase.java
index 0b852fa247c65cb1e889ad4e55886e256f89a763..2ec82dcb9d989590e59f88a02d1c205b3200cadc 100644
--- a/src/main/java/net/minecraft/world/level/block/state/BlockBase.java
+++ b/src/main/java/net/minecraft/world/level/block/state/BlockBase.java
@@ -670,10 +670,12 @@ public abstract class BlockBase {
         }
 
         public void a(WorldServer worldserver, BlockPosition blockposition, Random random) {
+            if (worldserver.purpurConfig.noTickBlocks.contains(getBlock())) return; // Purpur
             this.getBlock().tickAlways(this.p(), worldserver, blockposition, random);
         }
 
         public void b(WorldServer worldserver, BlockPosition blockposition, Random random) {
+            if (worldserver.purpurConfig.noTickBlocks.contains(getBlock())) return; // Purpur
             this.getBlock().tick(this.p(), worldserver, blockposition, random);
         }
 
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index 1e5dfaac19af7047243b991745a341782850cf20..608bd272762314f661920ab16bf17dbf108df178 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -11,8 +11,10 @@ import org.bukkit.configuration.ConfigurationSection;
 
 import java.util.ArrayList;
 import java.util.HashMap;
+import java.util.HashSet;
 import java.util.List;
 import java.util.Map;
+import java.util.Set;
 import java.util.logging.Level;
 
 import static net.pl3x.purpur.PurpurConfig.log;
@@ -201,6 +203,16 @@ public class PurpurWorldConfig {
         playerInvulnerableWhileAcceptingResourcePack = getBoolean("gameplay-mechanics.player.invulnerable-while-accepting-resource-pack", playerInvulnerableWhileAcceptingResourcePack);
     }
 
+    public Set<Block> noTickBlocks = new HashSet<>();
+    private void noTickBlocks() {
+        getList("blocks.no-tick", new ArrayList<>()).forEach(key -> {
+            Block block = IRegistry.BLOCK.get(new MinecraftKey(key.toString()));
+            if (!block.getBlockData().isAir()) {
+                noTickBlocks.add(block);
+            }
+        });
+    }
+
     public boolean teleportIfOutsideBorder = false;
     private void teleportIfOutsideBorder() {
         teleportIfOutsideBorder = getBoolean("gameplay-mechanics.player.teleport-if-outside-border", teleportIfOutsideBorder);
