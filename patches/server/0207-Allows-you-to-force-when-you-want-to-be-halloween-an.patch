From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: DoctaEnkoda <bierquejason@gmail.com>
Date: Tue, 4 May 2021 00:11:01 +0200
Subject: [PATCH] Allows you to force when you want to be halloween and config
 the luck like the drop.


diff --git a/src/main/java/net/minecraft/world/entity/ambient/EntityBat.java b/src/main/java/net/minecraft/world/entity/ambient/EntityBat.java
index 88a0d51f78bee9a1b0762b46db4d91a9f8f8c75d..d5657409bb05c074d6cda95e085d5086843dd6ef 100644
--- a/src/main/java/net/minecraft/world/entity/ambient/EntityBat.java
+++ b/src/main/java/net/minecraft/world/entity/ambient/EntityBat.java
@@ -312,6 +312,8 @@ public class EntityBat extends EntityAmbient {
     private static final int ONE_HOUR = 20 * 60 * 60;
     private static int lastSpookyCheck = -ONE_HOUR;
     private static boolean eJ() {
+        // Purpur Start - Force Halloween
+        if (!net.pl3x.purpur.PurpurConfig.batForceHalloween) {
         if (MinecraftServer.currentTick - lastSpookyCheck > ONE_HOUR) {
         LocalDate localdate = LocalDate.now();
         int i = localdate.get(ChronoField.DAY_OF_MONTH);
@@ -319,8 +321,11 @@ public class EntityBat extends EntityAmbient {
             isSpookySeason = j == 10 && i >= 20 || j == 11 && i <= 3;
             lastSpookyCheck = MinecraftServer.currentTick;
         }
-
         return isSpookySeason;
+        } else {
+            return true;
+        }
+        // Purpur End
     }
     // Airplane end
 
diff --git a/src/main/java/net/minecraft/world/entity/monster/EntitySkeletonAbstract.java b/src/main/java/net/minecraft/world/entity/monster/EntitySkeletonAbstract.java
index 7ec60987229927e5fe7164f1d4eae8222832e920..c49324fd1fe0cad51ba47ddb443abc7fcae7ba2a 100644
--- a/src/main/java/net/minecraft/world/entity/monster/EntitySkeletonAbstract.java
+++ b/src/main/java/net/minecraft/world/entity/monster/EntitySkeletonAbstract.java
@@ -154,14 +154,23 @@ public abstract class EntitySkeletonAbstract extends EntityMonster implements IR
         this.eL();
         this.setCanPickupLoot(this.world.paperConfig.skeletonsAlwaysCanPickUpLoot || this.random.nextFloat() < 0.55F * difficultydamagescaler.d()); // Paper
         if (this.getEquipment(EnumItemSlot.HEAD).isEmpty()) {
+            // Purpur Start - Config Force & chance for Halloween
+            if (!net.pl3x.purpur.PurpurConfig.skeletonForceHalloween) {
             LocalDate localdate = LocalDate.now();
             int i = localdate.get(ChronoField.DAY_OF_MONTH);
             int j = localdate.get(ChronoField.MONTH_OF_YEAR);
 
-            if (j == 10 && i == 31 && this.random.nextFloat() < 0.25F) {
-                this.setSlot(EnumItemSlot.HEAD, new ItemStack(this.random.nextFloat() < 0.1F ? Blocks.JACK_O_LANTERN : Blocks.CARVED_PUMPKIN));
-                this.dropChanceArmor[EnumItemSlot.HEAD.b()] = 0.0F;
+            if (j == 10 && i == 31 && this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.skeletonChanceHasHead) {
+                this.setSlot(EnumItemSlot.HEAD, new ItemStack(this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.skeletonChanceHasJackOLantern ? Blocks.JACK_O_LANTERN : Blocks.CARVED_PUMPKIN));
+                this.dropChanceArmor[EnumItemSlot.HEAD.b()] = net.pl3x.purpur.PurpurConfig.skeletonChanceDropHead;
             }
+            } else {
+            if (this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.skeletonChanceHasHead) {
+                this.setSlot(EnumItemSlot.HEAD, new ItemStack(this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.skeletonChanceHasJackOLantern ? Blocks.JACK_O_LANTERN : Blocks.CARVED_PUMPKIN));
+                this.dropChanceArmor[EnumItemSlot.HEAD.b()] = net.pl3x.purpur.PurpurConfig.skeletonChanceDropHead;
+            }
+            }
+            // Purpur End
         }
 
         return groupdataentity;
diff --git a/src/main/java/net/minecraft/world/entity/monster/EntityZombie.java b/src/main/java/net/minecraft/world/entity/monster/EntityZombie.java
index 7112db516e62ca75a445482005c524129b84f54c..3c2f80c2de37aad99baa3fce180dc4f2c80fafbf 100644
--- a/src/main/java/net/minecraft/world/entity/monster/EntityZombie.java
+++ b/src/main/java/net/minecraft/world/entity/monster/EntityZombie.java
@@ -585,14 +585,23 @@ public class EntityZombie extends EntityMonster {
         }
 
         if (this.getEquipment(EnumItemSlot.HEAD).isEmpty()) {
+            // Purpur Start - Config Force & chance for Halloween
+            if (!net.pl3x.purpur.PurpurConfig.zombieForceHalloween) {
             LocalDate localdate = LocalDate.now();
             int i = localdate.get(ChronoField.DAY_OF_MONTH);
             int j = localdate.get(ChronoField.MONTH_OF_YEAR);
 
-            if (j == 10 && i == 31 && this.random.nextFloat() < 0.25F) {
-                this.setSlot(EnumItemSlot.HEAD, new ItemStack(this.random.nextFloat() < 0.1F ? Blocks.JACK_O_LANTERN : Blocks.CARVED_PUMPKIN));
-                this.dropChanceArmor[EnumItemSlot.HEAD.b()] = 0.0F;
+            if (j == 10 && i == 31 && this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.zombieChanceHasHead) {
+               this.setSlot(EnumItemSlot.HEAD, new ItemStack(this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.zombieChanceHasJackOLantern ? Blocks.JACK_O_LANTERN : Blocks.CARVED_PUMPKIN));
+               this.dropChanceArmor[EnumItemSlot.HEAD.b()] = net.pl3x.purpur.PurpurConfig.zombieChanceDropHead;
             }
+            } else {
+                if (this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.zombieChanceHasHead) {
+                    this.setSlot(EnumItemSlot.HEAD, new ItemStack(this.random.nextFloat() < net.pl3x.purpur.PurpurConfig.zombieChanceHasJackOLantern ? Blocks.JACK_O_LANTERN : Blocks.CARVED_PUMPKIN));
+                    this.dropChanceArmor[EnumItemSlot.HEAD.b()] = net.pl3x.purpur.PurpurConfig.zombieChanceDropHead;
+                }
+            }
+            // Purpur End
         }
 
         this.y(f);
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index 7e8654e4df61527f33d4fce2afdb14e29b90a4c2..9211f4846521e5a9d47ec033a8439114584d8388 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -254,9 +254,27 @@ public class PurpurConfig {
     }
 
     public static boolean endermanShortHeight = false;
+    public static boolean batForceHalloween = false;
+    public static boolean skeletonForceHalloween = false;
+    public static float skeletonChanceHasHead = 0.25F;
+    public static float skeletonChanceHasJackOLantern = 0.1F;
+    public static float skeletonChanceDropHead = 0.0F;
+    public static boolean zombieForceHalloween = false;
+    public static float zombieChanceHasHead = 0.25F;
+    public static float zombieChanceHasJackOLantern = 0.1F;
+    public static float zombieChanceDropHead = 0.0F;
     private static void entitySettings() {
         endermanShortHeight = getBoolean("settings.entity.enderman.short-height", endermanShortHeight);
         if (endermanShortHeight) EntityTypes.ENDERMAN.setEntitySize(EntitySize.b(0.6F, 1.9F));
+        batForceHalloween = getBoolean("settings.entity.bat.halloween.force-enable", batForceHalloween);
+        skeletonForceHalloween = getBoolean("settings.entity.skeleton.halloween.force-enable", skeletonForceHalloween);
+        skeletonChanceHasHead = (float) getDouble("settings.entity.skeleton.halloween.head-chance", skeletonChanceHasHead);
+        skeletonChanceHasJackOLantern = (float) getDouble("settings.entity.skeleton.halloween.jack-lantern-chance", skeletonChanceHasJackOLantern);
+        skeletonChanceDropHead = (float) getDouble("settings.entity.skeleton.halloween.drop-head-chance", skeletonChanceDropHead);
+        zombieForceHalloween = getBoolean("settings.entity.zombie.halloween.force-enable", skeletonForceHalloween);
+        zombieChanceHasHead = (float) getDouble("settings.entity.zombie.halloween.head-chance", skeletonChanceHasHead);
+        zombieChanceHasJackOLantern = (float) getDouble("settings.entity.zombie.halloween.jack-lantern-chance", skeletonChanceHasJackOLantern);
+        zombieChanceDropHead = (float) getDouble("settings.entity.zombie.halloween.drop-head-chance", skeletonChanceDropHead);
     }
 
     public static boolean dontSendUselessEntityPackets = false;
