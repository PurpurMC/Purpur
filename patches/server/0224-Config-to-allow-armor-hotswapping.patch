From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Encode42 <me@encode42.dev>
Date: Mon, 28 Jun 2021 15:32:57 -0400
Subject: [PATCH] Config to allow armor hotswapping

Not working on swap:
- Equip sound

diff --git a/src/main/java/net/minecraft/world/item/ArmorItem.java b/src/main/java/net/minecraft/world/item/ArmorItem.java
index ad095c6bc7e00d286c83e37f84d8ed5d4a2c6881..f6849ec7cbaae7a4820647e6bd6368dad43398af 100644
--- a/src/main/java/net/minecraft/world/item/ArmorItem.java
+++ b/src/main/java/net/minecraft/world/item/ArmorItem.java
@@ -139,14 +139,17 @@ public class ArmorItem extends Item implements Wearable {
         EquipmentSlot enumitemslot = Mob.getEquipmentSlotForItem(itemstack);
         ItemStack itemstack1 = user.getItemBySlot(enumitemslot);
 
-        if (itemstack1.isEmpty()) {
+        // Purpur start
+        boolean shouldSwap = world.purpurConfig.playerArmorSwapping && !itemstack1.isEmpty();
+        if (shouldSwap || itemstack1.isEmpty()) {
             user.setItemSlot(enumitemslot, itemstack.copy());
             if (!world.isClientSide()) {
                 user.awardStat(Stats.ITEM_USED.get(this));
             }
 
             itemstack.setCount(0);
-            return InteractionResultHolder.sidedSuccess(itemstack, world.isClientSide());
+            return InteractionResultHolder.sidedSuccess(shouldSwap ? itemstack1 : itemstack, true);
+            // Purpur end
         } else {
             return InteractionResultHolder.fail(itemstack);
         }
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index e3cba672d74930d2a8e160412d155eea0ca8b46a..71057de9690670fa6612b7dc1a44a77c516565d2 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -333,6 +333,7 @@ public class PurpurWorldConfig {
     public boolean playersSkipNight = true;
     public double playerCriticalDamageMultiplier = 1.5D;
     public boolean playerBurpWhenFull = false;
+    public boolean playerArmorSwapping = false;
     private void playerSettings() {
         idleTimeoutKick = getBoolean("gameplay-mechanics.player.idle-timeout.kick-if-idle", idleTimeoutKick);
         idleTimeoutTickNearbyEntities = getBoolean("gameplay-mechanics.player.idle-timeout.tick-nearby-entities", idleTimeoutTickNearbyEntities);
@@ -350,6 +351,7 @@ public class PurpurWorldConfig {
         playersSkipNight = getBoolean("gameplay-mechanics.player.can-skip-night", playersSkipNight);
         playerCriticalDamageMultiplier = getDouble("gameplay-mechanics.player.critical-damage-multiplier", playerCriticalDamageMultiplier);
         playerBurpWhenFull = getBoolean("gameplay-mechanics.player.burp-when-full", playerBurpWhenFull);
+        playerArmorSwapping = getBoolean("gameplay-mechanics.player.armor-hot-swapping", playerArmorSwapping);
     }
 
     public int snowballDamage = -1;
