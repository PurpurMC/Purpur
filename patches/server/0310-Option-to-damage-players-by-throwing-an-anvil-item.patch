From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: 12emin34 <macanovic.emin@gmail.com>
Date: Tue, 14 Mar 2023 18:45:44 +0100
Subject: [PATCH] Option to damage players by throwing an anvil item


diff --git a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
index 52a14af24e3c51c53b40fdb6594b1664eef6d486..c71c75b3ccb0a69430e0cf037095d0a498a476b7 100644
--- a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
+++ b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
@@ -451,6 +451,12 @@ public class ItemEntity extends Entity implements TraceableEntity {
             Item item = itemstack.getItem();
             int i = itemstack.getCount();
 
+            // Purpur start - anvil item damages players
+            if ((level.purpurConfig.anvilItemThrownDamagePlayerAmount > 0.0F) && (!this.onGround && (this.getOwner() != null && this.getOwner() != player) && (this.getItem().is(Items.ANVIL) || this.getItem().is(Items.CHIPPED_ANVIL) || this.getItem().is(Items.DAMAGED_ANVIL)))) {
+                player.hurt(level.damageSources().anvil(this.getOwner()), level.purpurConfig.anvilItemThrownDamagePlayerAmount);
+            }
+            // Purpur end
+
             // CraftBukkit start - fire PlayerPickupItemEvent
             int canHold = player.getInventory().canHold(itemstack);
             int remaining = i - canHold;
diff --git a/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java b/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
index fe903b1e1bd211651e3808becd34a2d28dc57f34..081a55c89378aeb67eec001d897b25ae3066b91f 100644
--- a/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
+++ b/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
@@ -735,11 +735,13 @@ public class PurpurWorldConfig {
     public boolean anvilColorsUseMiniMessage;
     public int anvilRepairIngotsAmount = 0;
     public int anvilDamageObsidianAmount = 0;
+    public float anvilItemThrownDamagePlayerAmount = 0.0F;
     private void anvilSettings() {
         anvilAllowColors = getBoolean("blocks.anvil.allow-colors", anvilAllowColors);
         anvilColorsUseMiniMessage = getBoolean("blocks.anvil.use-mini-message", anvilColorsUseMiniMessage);
         anvilRepairIngotsAmount = getInt("blocks.anvil.iron-ingots-used-for-repair", anvilRepairIngotsAmount);
         anvilDamageObsidianAmount = getInt("blocks.anvil.obsidian-used-for-damage", anvilDamageObsidianAmount);
+        anvilItemThrownDamagePlayerAmount = (float) getDouble("blocks.anvil.damage-to-players-when-thrown", anvilItemThrownDamagePlayerAmount);
     }
 
     public double azaleaGrowthChance = 0.0D;
